%\mychapter{3}{methodology}

\section{Current Project}

\subsection{Our framework}

We propose a method of pre-processing spike times by looking at the time since the previous spike, which we refer to as the previous time.  Our results are based on synthetic experiments which show  that noisy previous time data  capture  the  four and a half laps taken by a rat  around a simulated circular track.  We use the diffusion maps algorithm \cite{coifman2006diffusion}  to obtain a low dimensional model of the simulated data and compare the algorithm's performance with that of PCA.\\

Since we do not have  a suitable measure of error for  analyzing the effectiveness of both algorithms, we simulate clean
firing rate data which perfectly encodes the position of the animal on the track and compare the output of the  two
algorithms on both the clean firing rate data and the noisy previous time vectors.\\

Our motivation for using both  firing rate data  and previous time data  is based on the fact that the position of the animal is coded by place cells using both the firing rate and the precise time at which the cells fire with respect to the hippocampal theta rhythm. The theta rhythm is a sinusoid of frequency 7-12 Hz which occurs whenever a rat changes position in  a specific direction \cite{OKeefe1971, Burgess1993}.\\


In section  4.2 and 4.3,  we define the previous time function and illustrate it graphically.  In addition, we give a description of our simulation and analyzes used. In section 5, we show our results of diffusion maps and PCA on synthetic data sets.
Finally in section 6, we give a brief discussion on our results and suggest possible future directions.


\subsection{Nature of our raw real-world data}
The raw data set consists  of multiple single-unit single-trial spike trains,\\
\[ 
\text{T}^{\text{spike}} = \displaystyle \{ \{ t_{i}^{j} \} , 1 \leq i \leq n_{i}, 1 \leq j \leq 32 \}  
\]
recorded from 32 neurons, called  place cells, in the CA1 region of the rat hippocampus, where,
$\displaystyle  \{t_{i}^{j}\} =  \{t_{1}^{j}, ....., t_{n_{i}}^{j} \} $, represents  a sequences of n$_{i}$ recorded times at which the spikes of the $j^{th}$ neuron occurred. \\
However, we only show results based on synthetic data due to lack of a suitable measure of error to quantify 
the performance of  diffusion maps and PCA on real world data.  We pre-process the simulated spike trains by computing  the previous time  defined in section 4.2.1.
 

%%%%%%% %%%  deleted this because our firing rate does not have spikes   %%%%%%%%%%%%%%%%%%%%%%%%%%
%\subsubsection{Conversation to a firing rate}
%For each neuron labeled $j$,  we smooth the corresponding spike train T$^{\text{spike}}_{j}(t)$ to obtain the firing rate function $R^{j}(t).$ The  firing rate function, for the $j^{th}$ neuron is given by
%\begin{equation} \label{jfirerate}
%\text{R}^{j}(t) = \displaystyle \sum_{i=1}^{n_{i}}  \frac{1}{\sigma \sqrt{2\pi}} 
%e^{-\dfrac{(t_{i_{k}}^{j}  - t_{i_{l}}^{j})^2}{2\sigma^2}}. 
%\end{equation}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{The previous time function}

Given any time $t$, define the previous time of the $j^{th}$ neuron, denoted by $\text{P}^{j}(t)$ as follows. Let 
\[
t^{j}_{\text{prev}}(t) = \displaystyle \max  \{  t^{j}_{i} \ \ | \ \ t^{j}_{i} < t, 1 \leq i \leq n_{i} \} \ \ \text{for all spike trains} \quad  \{t^{j}_{i}\} \in T^{\text{spike}} 
\]
where $t^j_i$ denotes the $i^{th}$ spike of the $j^{th}$ neuron.  The previous time function, P$^{j}(t)$, is given by, 
\begin{equation}\label{prevtimefun}
\text{P}^{j}(t) = t^{j}_{\text{prev}}(t) - t.
\end{equation}


Figure \ref{fig:CellActivity_Prevtime} below illustrates how the previous time function is obtained from the firing activity of a given neuron.


 \begin{figure}[H]
        \centering
        \begin{subfigure}[b]{0.8\textwidth}
            \centering
            \includegraphics[width=\textwidth]{./images/CellActivityGraph.pdf}
            \caption[Cell activity]%
            {{\small Cell activity}}    
            \label{fig:Cell activity}
        \end{subfigure}
        
        \vskip\baselineskip
        \begin{subfigure}[b]{0.8\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{./images/PrevTime_graph.pdf}
            \caption[]%
            {{\small Previous time function}}    
            \label{fig:Prevtime}
        \end{subfigure}
        \caption[The previous time function for a single neuron ]
        {\small The previous time function based on the activity of a single neuron} 
        \label{fig:CellActivity_Prevtime}
  \end{figure}


\subsection{Simulation}
We consider a population of $N=32$ sensory neurons (place cells) encoding a 
one-dimensional circular stimulus variable, $\theta(t)$, which represents 
the position of the rat, at any time $t$ along a circular track, during
a behavioral task.
We let $\theta(t) = c t \ \ (\text{mod} \ \ 2\pi)$, where time $t$, is in seconds, $c = \dfrac{2\pi}{T_{\text{lap}}}$ is the speed of the animal, and
$\text{T}_{\text{lap}}$ is the time taken for the animal to make one lap around the circle.
From  $\theta(t)$,  we model the place field of the $j^{th}$ neuron using a Gaussian 

\begin{equation}
{g}^{j}(\theta) = \displaystyle  f_{\text{bg}} + f_{\max} 
\exp\bigg(-\dfrac{\text{dist}^{2}(\theta - \phi_{j})}{2\epsilon_{j}^{2}} \bigg)
\end{equation}

where $f_{bg}$ is the background firing rate that is independent of the underlying stimulus, $f_{\max}$ denotes the maximum firing rate of each neuron, $\epsilon_j \in  [0.01, 1]$ is the width of the $j^{th}$ neuron's place field  and $\phi_{j}$ is the preferred position of the $j^{th}$  neuron or the center of the j$^{th}$ place field. We assume that the centers of the place fields are distributed uniformly at random in space.  In particular, we set 
$$\phi_j = \frac{j2\pi}{N}, \ \    \text{for}   \ \    1 \leq j \leq N.$$

Given any two angles, $\theta_{1}, \theta_{2} \in [0, 2\pi]$, the quantity
$\text{dist}(\theta_{1}, \theta_{2})$ denotes the shortest distance between 
two points on a unit circle, given by
\[
\text{dist}(\theta_{1}, \theta_{2}) = \abs{\big( \big( (\theta_{1} - \theta_{2}) + \pi  \big) \ \ \text{mod} \ \ 2\pi \big) - \pi}.
\]

Our simulation assumes  that information about the animal's environment is  encoded by the firing rate function
$$R^{j}(t) =  \text{g}^{j}(\theta(t)).$$
Thus given a rat position $\theta(t)$, all the 32  neurons  in the simulated rat's brain fire according to the firing rate function  $R^{j}(t).$


\subsection{Analysis}
We set the start  and end time of the synthetic experiment  to be  $0$ and $T$ respectively. We then divide the interval
$[0, T],$ into equal sub-intervals  of width $\Delta t$.
We carry out  our analyzes  using two different data sets:  a firing rate and  previous time data set.
First, we sample from the firing rate function  $R^{j}(t)$ for each time point $t \in [0, T]$,
to obtain our clean synthetic firing rate data  set,
$$\{R^{1}(t),  R^{2}(t),    \ldots , R^{N}(t) \}. $$

The second data set is generated as follows: we assume that the experiment consists of a single trial and that the spike train  $\{ t^j_i \}$, of the $j^{th}$, neuron is generated according to a non-homogeneous poisson process with firing rate  $R^{j}(t) $ in the interval $[0, T].$ We then generate a spike  $t^j_i$ with probability $\text{R}^{j}(t)\Delta t \ll 1$, otherwise no spike is generated.  Next, we define the previous time function (see section 4.3 )  based on the  generated set of synthetic spike trains.  Finally, we sample from the previous time function to obtain our previous time data set

$$
\{ \Bm{P}^{1}(t), \Bm{P}^{2}(t), \ldots, \Bm{P}^{N}(t)^{\top}   \}.
$$


Thus at each time, $t_{i} \in [0,T]$, the position of the animal, $\theta(t_{i})$, is associated with a previous time vector, $\vect{p}(t_{i})$, and a firing rate vector, $\vect{r}(t_{i})$.




\subsection{Distance measure used in results section}
Given two time points $t_{1}$ and $t_{2}$ representing different fake brain states, we form the corresponding previous time vectors $\vect{p}(t_{1})= (p^{1}(t_{1}), p^{2}(t_{1}), \ldots, p^{32}(t_{1}))^{\top} $  and  $\vect{p}(t_{2}) = (p^{1}(t_{2}), p^{2}(t_{2}), \ldots, p^{32}(t_{2}))^{\top}$ in $\R^{32}$.

We use the l$_{1}$ norm to compute the distance between the two vectors:

\begin{equation}\label{distPrevtime}
\text{d}(\vect{p}(t_{1}), \vect{p}(t_{2}) ) = 
\displaystyle \sum_{i=1}^{32} \abs{ p^{i}(t_{1}) - p^{i}(t_{2})   }.
\end{equation}

Similarly, we use the $l_{1}$-norm to compute the distance between two firing rate vectors:

\begin{equation}\label{distFirerate}
\text{d}(\vect{r}(t_{1}), \vect{r}(t_{2}) ) = 
\displaystyle \sum_{i=1}^{32} \abs{ r^{i}(t_{1}) - r^{i}(t_{2})   }.
\end{equation}


\subsubsection{Similarity measure used in results section}
We form pairwise similarities, $s_{ij}$, between each data point
using the Gaussian kernel 
\[
s_{ij} = e^{-\dfrac{\text{dist}^{2}(\vect{x}_{i}, \vect{x}_{j})}{2\sigma^2}} 
\]
where $\text{dist}(\vect{x}_{i}, \vect{x}_{j})$ is given by equations
\eqref{distPrevtime} and \eqref{distFirerate}.
We then apply diffusion maps to the resultant similarity matrix S = (s$_{ij}$) 
as described in section 3.3.8, to obtain a low dimensional model for the 
firing rate and previous time data.
The two parameters in diffusion maps are $\sigma$ and $\alpha$.
We set $\sigma =1$ and $\alpha = 0.5$ for all our synthetic results.























%\begin{itemize}

%========suggested by Duane=========================================
%\item  First mention that there is a general conceptual framework
%namely dimensionality reduction and then say that
% the metric a approach is just one of the ways of doing dim reduction
% yet ensuring minimal information loss.

%\item The previous/next time approach is our new way of preprocessing
% the data and then using some of the usual metrics to analyze it.

%============end suggestion=========================================
%\item How did you create the metric and what precisely is it's definition?
%\item Experimental design. Discuss how the data was collected using a diagram
%\item Mention that this kind of analysis has never been 
%applied to this Redish Lab data.
%\item describe your methodology starting with the fake brain model and then tests on real data
%\item what are the names and definitions of the algorithms you're using?
%\item what is dimensionality reductions and why are you using linear instead of non linear
%\item Why did you choose this particular algorithm(s)?
%\item What is wrong with using PCA or Kernel PCA?
%
%\end{itemize}





